# Dockerfile.env - Environment image for specific Bun version
# Installs a specific version of Bun for testing

ARG BASE_IMAGE=bunbench.base
FROM ${BASE_IMAGE}

LABEL maintainer="bun-bench"
LABEL description="Bun environment with specific version"

# ARG for Bun version to install
ARG BUN_VERSION=latest

# Store the version as an environment variable
ENV BUN_VERSION=${BUN_VERSION}

# Switch to bunuser
USER bunuser
WORKDIR /home/bunuser

# Install specific Bun version
RUN if [ "$BUN_VERSION" = "latest" ]; then \
        curl -fsSL https://bun.sh/install | bash; \
    else \
        curl -fsSL https://bun.sh/install | bash -s "bun-v${BUN_VERSION}"; \
    fi

# Verify the installed version
RUN bun --version

# Set up working directory for projects
WORKDIR /home/bunuser/workspace

# Copy package.json if it exists (using wildcard to make it optional)
COPY --chown=bunuser:bunuser package*.json* ./

# Install dependencies if package.json exists
RUN if [ -f package.json ]; then bun install; fi

# Default command
CMD ["/bin/bash"]
